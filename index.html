<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <title>AR.js Model Swap (1エンティティ版)</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    body{margin:0;overflow:hidden}
    #ui{position:fixed;left:0;right:0;bottom:1rem;display:flex;justify-content:center;gap:.5rem}
    .model-btn{padding:.6rem 1rem;border:1px solid #fff;border-radius:8px;
      background:rgba(0,0,0,.55);color:#fff;font-size:.9rem}
  </style>
    <script>
        AFRAME.registerComponent('apply-shadowmaterial', {
        init: function () {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) { return; }
            // 既存のマテリアルを破棄
            mesh.material.dispose();
            // 透明シャドウ用マテリアルを設定
            mesh.material = new THREE.ShadowMaterial({ opacity: 0.6 });
            mesh.receiveShadow = true;
        }
        });
    </script>
</head>
<body>
<a-scene embedded arjs
          shadow="enabled: true; autoUpdate: true; type: pcfsoft; mapSizeWidth: 1024; mapSizeHeight: 1024">

          <a-entity light="type: ambient;
          color: #ffffff;
          intensity: 0.5">
            </a-entity>

            <!-- 光源 -->
            <a-entity light="type: directional;
            color: #ffffff;
            intensity: 0.8;
            castShadow: true;
            shadowCameraNear: 0.1;
            shadowCameraFar: 1000;
            shadowCameraLeft: -10;
            shadowCameraRight: 10;
            shadowCameraTop: 10;
            shadowCameraBottom: -10"
            position="0 10 0"
            rotation="0 0 -90">
            </a-entity>


    <a-marker type="pattern" url="./patternAR.patt" size="0.16">
    <!-- ここだけ１つのエンティティ -->
    <a-entity id="model"
              position="1.1 0 0"
              scale="1 1 1"
              animation-mixer
              shadow="cast: true; receive: false">
    </a-entity>
  </a-marker>
  <a-entity camera></a-entity>
  <a-assets>
    <a-asset-item id="m1" src="./aokuro_low.glb"></a-asset-item>
    <a-asset-item id="m2" src="./akakuro_low.glb"></a-asset-item>
    <a-asset-item id="m3" src="./akashiro_low.glb"></a-asset-item>
    <a-asset-item id="m4" src="./kuroshiro_low.glb"></a-asset-item>
    <a-asset-item id="m5" src="./murasaki_low.glb"></a-asset-item>
  </a-assets>
</a-scene>

<div id="ui">
  <button class="model-btn" data-src="#m1">model 1</button>
  <button class="model-btn" data-src="#m2">model 2</button>
  <button class="model-btn" data-src="#m3">model 3</button>
  <button class="model-btn" data-src="#m4">model 4</button>
  <button class="model-btn" data-src="#m5">model 5</button>
</div>

<script>
  const modelEl = document.querySelector('#model');
  document.querySelectorAll('.model-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const assetId = btn.dataset.src;
      // 以前のメッシュを完全に破棄
      modelEl.removeObject3D('mesh');
      // 新しいモデルをロード
      modelEl.setAttribute('gltf-model', assetId);
    });
  });
  // 最初に 1 を読み込んでおく
  document.querySelector('[data-src="#m1"]').click();
</script>
</body>
</html>
